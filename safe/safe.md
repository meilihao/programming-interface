# safe
## SLA
服务等级协议（Service Level Agreement，SLA），是指在一定开销下，为了保证服务的性能和可用性，服务提供商与用户之间签订的得到双方认可的协议或合同.

一般来说，SLA通过两种标准来衡量：一是故障发生到恢复的时间；二是两次故障的间隔时间. 大多都是采用第一种标准，也就是服务不可用的时间.

![SLA](/misc/img/io/Image00137.jpg)

SLA里面的9越多，代表一定时间内服务的可用时间越长、服务越可靠，停机时间越短，反之亦然.

## MTTR、MTTF和MTBF
平均无故障时间（Mean Time To Failure，MTTR）: 指系统无故障运行的平均时间，即系统平均正常运行多长时间，才会发生一次故障.
平均修复时间（Mean Time To Repair，MTTF）: 指系统从发生故障到维修结束恢复正常运行需要花费的时间的平均值.
平均失效间隔（Mean Time Between Failure，MTBF）是指系统两次故障发生之间的平均时间.

MTTR, MTTF，MTBF 是可以被用来衡量可用性的另外几个指标.

## 高可用方案
1. 备份

	最容易想到的方案，备份的优点是延迟低、吞吐量高，但缺点是可能会导致数据丢失，而且故障切换（Failover）要接受一定的停机时间（Downtime）.

	备份数据丢失的主要原因:
	1. 备份是周期性的, 从备份时间到故障发生时的数据丢失
	1. 备份数据可能有版本不兼容
	1. 备份系统没正常工作

1. 两阶段提交协议(Two Phase Commitment Protocol，2PC）

	具有较高的延迟和较低的吞吐量，但是不会发生数据丢失的情况，并且可以做到实时切换.

	两阶段提交协议主要基于分布式一致性算法，能够保证多台服务器上的操作或全部成功，或全部失败.


## 存储可靠性
### 磁盘阵列
磁盘阵列主要基于3种关键的技术：镜像、数据条带（Data Stripping）和数据校验（Data Parity）.
- 镜像：数据在多个磁盘上存在副本，一方面提高了系统的可靠性，另一方面可以通过从多个副本并发读取数据的方式来提高读性能. 但是由于副本的存在，要确保数据正确地写到多个磁盘需要消耗更多的时间.
- 数据条带：将数据分片保存在多个不同的磁盘，这些数据分片共同组成一个完整的数据副本。数据条带具有更高的并发粒度，当访问数据时，可以对位于不同磁盘上的数据同时进行读/写操作，从而极大地提升了I/O的性能。
- 数据校验：利用冗余数据进行数据错误检测和修复。冗余数据通常采用海明码、异或操作等算法来计算获得. 数据校验功能在很大程度上提高了磁盘阵列的可靠性、鲁棒性和容错能力。不过，由于需要从多处读取数据并进行计算和对比，所以数据校验也会影响系统性能.

### 纠删码
纠删码能够基于更少的冗余设备，提供和副本近似的可靠性. 但是纠删码也带来了计算量和网络负载的额外负担.

在实际的生产环境里，单个磁盘发生故障的概率远大于多个磁盘同时发生故障的概率. 基于这种情况，一种新的思路是将磁盘分组，把单个磁盘故障的影响范围限制在各个组内，在组内的磁盘出现故障时，重建数据只需要读取组内的磁盘，所以需要的网络流量更少，从而减少对全局的影响.

于是LRC（Locally Repairable Codes）算法被提出，核心思想是除了全局的冗余块，还将数据块进行分组，为每组数据块增加冗余. 在这种情况下，当一个数据块出现故障时，只需要读取组内的数据块和冗余块即可，这大大加快了数据重建的速度.

### 数据完整性
#### 奇偶校验
奇偶校验（Parity Check）就是在发送的每字节后都加上一位校验位，使得每字节中1的个数为奇数或偶数.

它对错误检测成功的概率大约只有50%. 另外，每传输一字节都要附加一位校验位，极大地增加了网络负载，因此在高速的数据通信中比较少用.

#### MD5、SHA和MAC等摘要算法
#### 累加和校验
累加和校验的实现方式有很多种，最常用的方式是在一次通信过程中，在数据包的最后加入一字节的校验数据，这一字节的内容为之前所有数据包中数据的按字节累加和（忽略进位）.

累加和校验的检错能力比较一般，但由于实现起来非常简单，所以也被广泛地采用.

#### CRC
CRC算法的基本思想是将传输的数据当作一个位数很长的数，将这个数除以另一个数，得到的余数作为校验数据附加到原始数据后面.

基于应用环境与习惯的不同，CRC又可分为CRC12、CRC16、CRC32等，最常见的是CRC32，它产生一个4字节的校验值. 很多压缩软件中，都是以CRC32作为文件校验算法.

## 访问控制（Access Control）
通常用于控制用户对服务器、目录、文件等网络资源的访问，从而保障数据资源在合理、合法的范围内得以有效使用和管理.

1. DAC

	自主访问控制（Discretionary Access Control，DAC）主要包括主体、客体、权限、所有权。主体是用户的身份，客体是资源，由主体自主决定是否将自己的客体访问权限或部分访问权限授予其他主体. 也就是说，在DAC下，用户可以根据自己的意愿，有选择地与其他用户共享自己的文件.

	DAC相对比较宽松，但却能有效地保护资源而不被非法访问. 宽松是因为在保护资源的时候是以个人意志为转移的，有效是因为可以明确指出主体以何种权限来访问某个客体，任何超越规定权限的访问行为都会被访问控制列表判定并阻止.

1. MAC

在DAC的机制中，由于自主性太强，可以说文件资源的安全性在很大的程度上取决于用户个人的意志. 比如root用户对资源进行误操作和权限滥用.

因为DAC的缺陷, 强制访问控制（Mandatory access control，MAC）这一安全概念被提出. MAC最早被应用于军方，通常与DAC结合使用. MAC的相关概念如下:
- 主体：通常是指用户，或由用户发起运行的进程，或用户正在使用的设备。主体主动发起对资源的访问。
- 客体：通常是指信息的载体，或从其他主体或客体接收信息的实体。主体有时也会成为访问或受控的对象，比如一个主体可以向另一个主体授权，一个进程可能控制几个子进程等，这时受控的主体或子进程也通常被认为是一种客体。

MAC将访问控制规则“强加”给访问主体，即系统强制主体服从访问控制策略。MAC的主要作用对象是所有主体及其所操作的客体（进程、文件等）。MAC为这些主体及其所操作的客体提供安全标记，并基于这些标记来实施MAC，比如通过比较主体和客体的安全标记来判断一个主体是否能够访问某个客体。

MAC一般与DAC结合使用，也就是说，一个主体只有通过了DAC与MAC的双重过滤之后，才能真正访问某个客体。一方面，用户可以利用DAC来防范其他用户对那些所有权归属于自己的客体进行攻击；另一方面，由于用户不能直接改变MAC安全标记，所以MAC提供了一个更强的安全保护层以防止其他用户偶然或故意地滥用DAC.

1. RBAC
DAC与MAC实现起来比较复杂，而且DAC安全性太弱，MAC安全性又太强，因此基于角色的访问控制（Role-Based Access Control，RBAC）被提出，并在主体与客体之间引入了角色的概念，主体基于不同的角色对客体进行访问.

RBAC即“用户—角色—权限”的授权模型：一个用户可以拥有若干个角色，每一个角色又拥有若干个权限，用户与角色之间，角色与权限之间，一般都是多对多的关系.

角色可以理解为权限的载体，是一定数量的权限的集合.

RBAC能够支持最小权限原则、责任分离原则和数据抽象原则等。基于最小权限原则，可以将其角色配置成完成任务需要的最小权限集。通过调用相互独立互斥的角色共同完成特殊任务，可以实现责任分离原则.