# device
root可使用 mknod 命令创建设备文件.

## 设备文件
设备文件让程序能够同系统的硬件和外围设备进行通信. 在Linux中,所有的设备以文件的形式出现在目录 /dev 中, 由`systemd-udevd`管理(随着kernel报告的硬件变化创建或删除设备文件).

设备用主设备号和次设备号表示其特征, 主设备号和次设备号统称为设备号. 主设备号用来查找一个特定的驱动程序, 次设备号用来表示使用该驱动程序的各设备.

> 设备文件的 i 节点中记录了设备文件的主、辅 ID. 每个设备驱动程序都会将自己与特定主设备号的关联关系向内核注册,藉此建立设备专用文件和设备
驱动程序之间的关系.

`crw-rw-rw-  1 root tty       4,     3 6月  26 21:34 tty3`, `4`是主设备号, `3`是次设备号.

实际上设备文件也分块设备文件(block special file) 和 字符设备文件(character special file).  块设备每次读取或写入一块数据(一组字节, 通常是512的倍数), 字符设备每次读取或写入一个字节.

还有一种有设备驱动但没有实际设备的虚拟设备称为伪设备, 比如pty(伪tty), /dev/null, /dev/random等.

## 块设备(block device) / 字符设备(character device)
- 块设备(**可寻址**) : 提供对设备(比如磁盘,蓝光光盘)带缓冲的访问, 每次访问以固定长度(块)为单位进行.
- 字符设备(**不可寻址**) : 接收或输出字符流的设备, 需**按顺序操作, 不支持随机操作**, 用于键盘, 串口, 打印机, 调制解调器等.

> Linux 专有文件/proc/partitions 记录了系统中每个磁盘分区的主辅设备编号、大小和名称.

## udev
在用户空间实现的一种设备管理系统, 它会将设备文件自动放在/dev下. 它依赖sysfs(/sys下的虚拟文件系统)来了解系统的设备变化, 并使用一系列udev特有的规则来指定其对设备的管理以及命令, 默认规则在`/lib/udev/rules.d`下, 自定义规则在`/etc/udev/rules.d`下.

## `/dev/loopN`
一种伪设备，使得文件可以如同块设备一般被访问.

可通过`losetup -a`查看.

snapd的`loopN`可通过`sudo apt autoremove --purge snapd`解决.
