# 存储
参考:
- [阿里云分布式存储系统的研究与分享](https://blog.7street.top/2018/04/13/pangu/)
- [浅谈分布式存储系统Pangu2.0——它让双11运维变得智能起来](https://segmentfault.com/a/1190000012526855)

## 硬盘
低级格式化: 划分磁道和扇区的过程, 通常由厂商完成.
高级格式化: 对磁盘上所存储的数据进行文件系统的标记.
柱面: 所有盘面上的同一磁道, 在竖直方向上构成一个柱面. 数据的读写按柱面进行, 从上往下在同一柱面的不同盘面进行操作, 只有该柱面的所有操作完成后磁头才会移动到下一个柱面.
扇区: 将每个环形磁道等距切割, 形成等长度的圆弧, 每个圆弧就是一个扇区. 每个扇区 = 扇区标识符 + 扇区数据段(4K). 扇区地址使用LBA编址方式(线性地址).

> 以前每个磁道的扇区数相同,且每个扇区的容量相同. 现在很多硬盘采用同密度盘片，意味着内外磁道上的扇区数量不同，外磁道的扇区数量有所增加.
> 磁盘每个时刻只允许一个磁头读写数据.

影响磁盘性能的因素:
1. 转速
1. 寻道速度
1. 接口速度
1. 单碟容量

磁盘接口技术:
- ATA : SATA
- SCSI
- NVMe : 全称Non-Volatile Memory Express，非易失性存储器标准，是使用PCI-E通道的SSD一种规范，相比与现在的AHCI标准，NVMe标准可以带来多方面的性能提升

> NVMe标准定义了SSD的访问命令及操作方式，并且定义了逻辑设备接口标准；和SATA体系类比，NVMe标准替代了SATA体系中的AHCI逻辑接口以及ATA/SCSI命令规范.
> NVMe over Fabric，有两种类型的传输方式: 使用远程直接内存访问(RDMA)和使用光纤通道(FC-NVMe), 用以取代iSCSI和走光纤通道的SCSI.

## RAID
Redundant Array of Indepent Disks (独立磁盘冗余阵列) 

一共有0~6一共7种，这其中RAID 0、RAID1、RAID 5和RAID6比较常用.

![总结](https://img-blog.csdn.net/20160712135213243?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)

### RAID 0
![](https://img-blog.csdn.net/20160712135137243?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)
RAID 0的特点：
- 最少需要2块磁盘
- 数据条带式分布
- 没有冗余，性能最佳(不存储镜像、校验信息)
- 安全性能低, 不支持数据冗余，无容错功能，不能应用于对数据安全性要求高的场合即不适用于关键任务环境
- 磁盘空间使用率：100%，成本最低

### RAID 1
![](https://img-blog.csdn.net/20160712135148165?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)
RAID 1的特点：
- 最少需要2块磁盘
- 提供数据块冗余, 磁盘的利用率却只有50%，磁盘利用率最低，成本最高
- 数据冗余备份，容错，数据安全性高；当故障发生时，系统可自动切换到镜像磁盘，无需重组数据
- 读性能：只能在一个磁盘上读取，取决于磁盘中较快的那块盘
- 写性能：两块磁盘都要写入，虽然是并行写入，但因为要比对，故性能单块磁盘慢

### RAID 3
![]()
实际数据占用的有效空间为N个硬盘的空间总和，而第N+1个硬盘上存储的数据是校验容错信息

特点:
- n最少为3
- 校验码集中在单独的一块磁盘

### RAID 5
![](https://img-blog.csdn.net/20160712135201306?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)
RAID 5特点：
- 最少3块磁盘
- 数据条带形式分布
- 高可靠性, 奇偶校检与数据分别都存储不同盘. 损坏时，可以自动重建, 但只允许一块磁盘损坏
- 适合多读少写的情景，是性能与数据冗余最佳的折中方案
- (n-1)*单块磁盘的读性能，和RAID0相近似的数据读取速度
- 写入数据的速度比对单个磁盘进行写入操作稍慢
- 磁盘空间利用率：(N-1)/N，即只浪费一块磁盘用于奇偶校验, 存储成本相对较低

Raid6:
类似RAID5两组奇偶校验信息块，两个独立的奇偶系统使用不同的算法， 数据的可靠性非常高，即使两块磁盘同时失效也不会影响数据的使用.
相对于RAID 5有更大的`写损失`，因此`写性能`非常差.

### RAID 10
![](https://img-blog.csdn.net/20160712135207894?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)
RAID 10(又叫RAID 1+0)特点：
- 最少需要4块磁盘
- 先按RAID 0分成两组，再分别对两组按RAID 1方式镜像, 安全性上RAID10要好于 RAID01
- 兼顾冗余(提供镜像存储)和性能(数据条带形分布)
- 在实际应用中较为常用
- 磁盘利用率50% 成本较高
- RAID01比起RAID10有着更快的读写速度

## DAS、SAN、NAS网络存储的异同
参考:
- [存储相关知识-DAS/SAN/NAS](https://yq.aliyun.com/articles/467199)

![](http://n.sinaimg.cn/translate/20170530/s8xI-fyfrfvv5160915.jpg)
NAS、SAN和DAS三者的目的相同：存储, 但是初衷、达成路径和结果也不相同.

> 从NAS与SAN系统的角度来看，NAS用于文件I/O，SAN用于块I/O. 比较NAS与SAN时需要记住的另一件事是，NAS最终将文件I/O请求转换为与其相连的存储设备的块访问.
> 供应商现在开始提供具有NAS或SAN体验的前端系统，而后端则基于对象存储
> 共享访问文件的环境，最好使用 NAS, 因为它自带文件系统.

DAS(Direct-Attached Storage), 是服务器中的一部分，将外置存储通设备通过SCSI或FC接口直接连接到应用服务器上来使用. 事实上，这种DAS存储模式，一般在中小型企业汇总应用十分广泛.
它更依赖主机的操作系统来实现数据的IO读写、数据管理、数据备份等工作, 但是这种存储模式也存在一定的缺点, 比如可管理性差、弹性扩展能力弱，难以跟上IT发展趋势等问题.

NAS 和 SAN 存储系统的区别是 NAS 有自己的文件系统管理.
NAS 是将目光集中在应用、用户和文件以及它们共享的数据上. SAN 是将目光集中在磁盘、磁带以及联
接它们的可靠的基础结构. 将来从桌面系统到数据集中管理到存储设备的全面解决方案将是 NAS 加 SAN.

## SAN
SAN(Storage Area Network)存储区域网络，是一种高速的、专门用于存储操作的网络，通常独立于计算机局域网(LAN).
SAN将主机和存储设备连接在一起，能够为其上的任意一台主机和任意一台存储设备提供专用的通信通道.
SAN将存储设备从服务器中独立出来，实现了服务器层次上的存储资源共享.
SAN将通道技术和网络技术引入存储环境中，提供了一种新型的网络存储解决方案，能够同时满足吞吐率、可用性、可靠性、可扩展性和可管理性等方面的要求.
 
### FC-SAN
通常SAN由磁盘阵列(RAID)连接光纤通道(Fibre Channel)组成(为了区别于IP SAN，通常SAN也称为FC-SAN). SAN和服务器和客户机的数据通信通过SCSI命令而非TCP/IP，数据处理是`块级(lock level)`.

### IP-SAN
简单来讲，IP-SAN（IP存储）的通信通道是使用IP通道，而不是光纤通道，把服务器与存储设备连接起来的技术，除了标准已获通过的iSCSI，还有FCIP、iFCP等正在制定的标准, 而iSCSI发展最快，已经成了IP存储一个有力的代表.
像光纤通道一样，IP存储是可交换的，但是与光纤通道不一样的是，IP网络是成熟通用的，不存在互操作性问题，而光纤通道SAN最令人头痛的就是这个问题.

IP存储的优势：
1. 利用无所不在的IP网络，一定程度上保护了现有投资.
1. IP存储超越了地理距离的限制, 十分适合于对现存关键数据的远程备份.
1. IP网络技术成熟, IP存储减少了配置、维护、管理的复杂度.

## SCSI
小型计算机系统接口（英语：Small Computer System Interface; 简写：SCSI），一种用于计算机和智能设备之间（硬盘、软驱、光驱、打印机、扫描仪等）系统级接口的独立处理器标准.
它是一种智能的通用接口标准，它具备与多种类型的外设进行通信的功能. SCSI采用ASPI（高级SCSI编程接口）的标准软件接口使驱动器和计算机内部安装的SCSI适配器进行通信.
SCSI接口广泛应用于小型机上的高速数据传输技术。SCSI接口具有应用范围广、多任务、带宽大、CPU占用率低，以及热插拔等优点.

> SAS(serial attached SCSI)是串行连接的SCSI,是新一代的SCSI技术，和现在流行的Serial ATA(SATA)硬盘相同，都是采用串行技术以获得更高的传输速度，并通过缩短连结线改善内部空间等.
> 此接口的设计是为了改善存储系统的效能、可用性和扩充性，提供与串行ATA (Serial ATA，缩写为SATA)硬盘的兼容性.

### iSCSI
参考:
- [iSCSI存储技术全攻略](https://www.sansky.net/article/2007-12-03-iscsi-storage.html)

iSCSI即internet SCSI，是IETF制订的一项存储传输协议标准，目的是为了用IP协议将存储设备连接在一起.
它是将SCSI数据区块映像成以太网数据封包, 并通过IP网络来传输SCSI 数据区块的方法.
发起读写请求的来源机器设备称作Initiator（发起方），被请求的目标设备则称作Target, 透过这种方式可在IP网络上以区块级模式存取大量数据.

> ISCSI技术的核心是在TCP/IP网络上传输SCSI协议，是指用TCP/IP报文、和ISCSI报文封装SCSI报文，使得SCSI命令和数据可以在普通以太网络上进行传输.

## 指标
Recovery Point Objective (RPO) : 指的是最多可能丢失的数据的时长.
Recovery Time Objective (RTO) : 指的是从灾难发生到整个系统恢复正常所需要的最大时长.

## 串行总线磁盘为什么比并行总线磁盘快
实际的传输速率是位宽和频率的乘积，如果频率相同，没错16bit的并口传输是串口的传输的十多倍，但是随着频率的大幅提高，并口多根信号线之间的串扰越来越严重.
当达到一定频率之后，并口传输的数据开始失真，就不能再提高传输频率了; 而串口通信一般是采用的差分信号，功耗低，串扰问题很小，因此可以大幅提高通信频率.
