# net
计算机网络就是将多个独立工作的计算机系统通过通信线路相互连接构成的集合, 即其由计算机设备, 网络设备, 传输介质以及支持这些硬件的软件组成.

分层结构
![OSI(Open System Interconnect, 开放系统互连参考模型) vs TCP/IP model](images/net/OSI-vs-TCP-IP-model.jpg)
![OSI, TCP/IP, protocol](images/net/tcp_ip_layers.png)
![各层数据封装](images/net/package_layers.png)
![frame](images/net/frame.png)

> 分层(是计算机领域的常用技巧)是为了隔离，通过分层划分职能，拆解问题，层与层之间约定接口，屏蔽实现细节
> ISO七层是理论, TCP/IP四层是实践
> 物理层与数据链路层区别: 物理层是物理链路; 数据链路层是基于物理层的逻辑链路. 有点类似与http2中的connection与stream的关系.

七层model各层作用:
7. 给用户应用的提供接口
6. 进行数据格式的转换
5. 会话管理
4. 从端对端透明地传送报文
3. 分组传输和路由选择
2. 在链路上无错地传输帧, 常见设备网卡, 网桥, 二层交换机
1. 将数据以比特流的形式在物理介质上传输, 常见设备网线, 光纤

计算机网络分类:
- 按照网络覆盖的地理范围
    1. 局域网(LAN, Local Area Network), 比如常见的无线局域网(WLAN)
    1. 城域网(MAN, Metropolitan Area Network)
    1. 广域网(WAN, Wide Area Network), 比如Internet
- 按照网络管理模式
    1. 对等网(PTP)
    1. C/S网
- 按照传输方式
    1. 点对点传输, 比如modem使用的PPOE
    1. 广播式传输

## 物理层
双绞”(双绞线)是为了抑制噪声.
集线器会将信号(原样)发送给所有连接在它上面的线路即广播出去.
交换机端口的 **MAC 模块不具有 MAC 地址**, 它会根据帧中的目的MAC查 CAM表(MAC与交换机端口的映射表,通过帧的源MAC和广播查询MAC构建的)，然后将信号发送到相应的端口.

> VLAN(虚拟局域网)中, 交换机的CAM表为(MAC地址, VLAN ID, 交换机端口), 为了提高广播查找效率, 它还会建立VLAN配置表(VLAN ID,该VLAN包含的所有交换机端口)
![二层交换原理](images/l2_switch.png)

广播地址（ broadcast address）是一种特殊的地址，将广播地址设为接收方地址时，包会发送到网络中所有的设备. MAC 地址中的 FF:FF:FF:FF:FF:FF和 IP 地址中的 255.255.255.255 都是广播地址.

路由器是**基于 IP 设计的，工作在网络层**, 是数据传输过程中的指路人, 是能够连接不同的广域网形成更大的广域网.
交换机是**基于以太网设计的, 工作在数据链路层**, 是将以太网连接形成更大的以太网.
网关(Gateway)又称网间连接器/**协议转换器**. 网关在网络层以上实现网络互连，是最复杂的网络互连设备，仅用于两个高层协议不同的网络互连, 充当翻译功能.

交换机是通过 MAC 头部中的接收方 MAC 地址来判断转发目标的， 而路由器则是根据 IP 头部中的 IP 地址来判断的.
路由器会忽略主机号，只匹配网络号.
路由表中子网掩码为`0.0.0.0`的记录表示`默认路由`.
地址转换NAT的基本原理是在转发网络包时对 IP 头部中的 IP 地址和端口号 进行改写.

### mac
作用:
1. 寻址(mac地址)
1. 解决网络中多个用户争抢公用传输通道

寻址需要依靠arp. mac帧分三种:
1. 单播 : 目的mac地址是一个单播mac地址的帧
1. 广播帧 : 目的mac地址是一个广播mac地址(全是`1`)的帧
1. 多播帧 : 目的mac地址是一个多播mac地址的帧