# p2p
http和ftp难以解决单一服务器的带宽压力, 因为它们使用的都是传统的客户端服务器的方式.

P2P就是peer-to-peer, 资源开始并不集中地存储在某些设备上,而是分散地存储在多台设备上.

> FTP(**即将废弃, 不推荐)** 采用两个 TCP 连接来传输一个文件: 控制连接+数据连接.

## 种子(.torrent)文件
.torrent 文件由两部分组成,分别是: announce(tracker URL)和文件信息, 其特别依赖 tracker.

文件信息里面有这些内容:
- info 区:这里指定的是该种子有几个文件、文件有多长、目录结构,以及目录和文件的名字
- Name 字段:指定顶层目录名字
- 每个段的大小:BitTorrent(简称 BT)协议把一个文件分成很多个小段,然后分段下载
- 段哈希值:将整个种子中,每个段的 SHA-1 哈希值拼在一起

tracker 服务器会回应下载者的请求,将其他下载者(包括发布者)的 IP 提供给下载者.

> 虽然下载的过程是非中心化的,但是加入这个 P2P 网络的时候,都需要借助 tracker 中心服务器,这个服务器是用来登记有哪些用户在请求哪些资源.

## 去中心化网络(DHT, Distributed Hash Table)
每个加入这个 DHT 网络的人,都要负责存储这个网络里的资源信息和其他成员的联系信息,相当于所有人一起构成了一个庞大的分布式存储数据库. 有一种著名的 DHT 协议,叫Kademlia 协议.

DHT中每个节点都有两个角色:
- peer : 监听一个 TCP 端口,用来上传和下载文件,这个角色表明,我这里有某个文件另一个角色- - DHT node : 监听一个 UDP 的端口,通过这个角色,这个节点加入了一个 DHT 的网络, 每一个 DHT node 都有一个 ID.

    每个 DHT node 都有责任掌握一些知识,也就是部分文件索引,也即它应该知道某些文件是保存在哪些节点上.

DHT 算法是这样规定的:
1. 如果一个文件计算出一个哈希值,则和这个哈希值一样的那个 DHT node,就有责任知道从哪里下载这个文件,即便它自己没保存这个文件.
1. 除了一模一样的那个 DHT node 应该知道,ID 和这个哈希值非常接近的 N 个 DHTnode 也应该知道

在DHT模式下,种子.torrent 文件里面就不再是 tracker 的地址了,而是一个 list 的 node 的地址. 只要在种子里面找到一个 DHT node,就加入了网络.