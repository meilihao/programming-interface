# dns
dns是让人使用名称, 让路由器使用 IP 地址进行通信的机制.

递归查询: dns server接收到客户机请求，**必须使用一个准确的查询结果回复客户机**. 如果dns server本地没有存储查询DNS 信息，那么该服务器会询问其他服务器，并将返回的查询结果提交给客户机. 主体是dns server.

迭代查询: DNS 服务器会向客户机提供其他能够解析查询请求的DNS 服务器地址，当客户机发送查询请求时，DNS 服务器并不直接回复查询结果，而是告诉客户机另一台DNS 服务器地址，客户机再向这台DNS 服务器提交请求，依次循环直到返回查询的结果为止. 主体是 客户机.

![递归和迭代](/misc/img/net/181202194057572.png)

`/etc/resolv.conf`里放了支持的nameserver.
`dig www.baidu.com +trace`可了解整个dns查询过程.

> Let's Encrypt支持使用ACMEv2协议, 其可基于DNS(TXT DNS记录)来验证申请者对域名的所有权，从而签发证书.

### 多重响应
dns server返回多条dns记录, 起到负载均衡的效果.

## FQDN
全域名(FQDN，Fully Qualified Domain Name)是指主机名加上全路径，全路径中列出了序列中所有域成员(包括root). 全域名可以从逻辑上准确地表示出主机在什么地方，也可以说全域名是主机名的一种完全表示形式.

## RR
资源记录（RR）
- A记录： 用于查询IP地址
- PTR记录： 逆向查询记录，用于从IP地址查询域名
- CNAME： 表示“规范名字”，用来表示一个域名，也通常称为别名
- HINFO： 表示主机信息，包括主机CPU和操作系统的两个字符串
- MX： 邮件交换记录
- NS： 名字服务器记录，即下一级域名信息的服务器地址，只能设置为域名，不能是IP

## example
```
dig k8s.io # 正向查询
dig -x 23.236.58.218 # 反向查询
```

## FAQ
### 用UDP还是TCP
DNS服务器支持TCP和UDP两种协议的查询方式，而且端口都是53。而大多数的查询都是UDP查询的，一般需要TCP查询的有两种情况：
1. 当查询数据多大以至于产生了数据截断(TC标志为1)，这时，需要利用TCP的分片能力来进行数据传输（看TCP的相关章节）
1. 当主（master）服务器和辅（slave）服务器之间通信，辅服务器要拿到主服务器的zone信息的时候